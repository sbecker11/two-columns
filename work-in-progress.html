<!DOCTYPE html>
<html>
  <head>
    <title>Equal-Width Columns</title>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #container {
        display: flex;
        height: 100%;
      }

      #left-column {
        flex: 1;
        background-color: black;
        overflow-y: scroll;
        position: relative;
      }

      #right-column {
        flex: 1;
        background-color: darkgrey;
        position: relative;
      }

      #report {
        color: white;
        position: absolute;
        top: 10px;
        left: 10px;
        white-space: pre-line;
        font-family: monospace;
      }

      #canvas {
        width: 100%;
        height: 100%;
        position: relative;
      }

      .red-div {
        width: 150px;
        height: 150px;
        margin: 20px auto;
        background-color: red;
      }

      #center-div {
        width: 2px;
        height: 2px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid white;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="left-column">
        <div id="canvas">
          <!-- 10 red divs will be dynamically added here -->
        </div>
        <div id="center-div"></div>
      </div>
      <div id="right-column">
        <canvas id="canvas"></canvas>
        <pre id="report"></pre>
      </div>
    </div>

    <script>
      // Function to update the report element
      function report(message) {
        document.getElementById("report").innerHTML = message;
      }

      // Call report("started") before the left column is initialized
      report("started");

      // Function to generate a random integer between min and max (inclusive)
      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      // Function to create each red div with additional properties
      function createRedDiv() {
        var redDiv = document.createElement("div");
        redDiv.className = "red-div";
        //redDiv.style.position = "absolute";

        document.getElementById("canvas").appendChild(redDiv);
        var redDivRect = redDiv.getBoundingClientRect();
        var origCtrX = redDivRect.left + redDivRect.width / 2;
        var origCtrY = redDivRect.top + redDivRect.height / 2;
        var randZ = getRandomInt(1, 8);

        redDiv.setAttribute("data-orig-ctr-x", origCtrX);
        redDiv.setAttribute("data-orig-ctr-y", origCtrY);
        redDiv.setAttribute("data-rand-z", randZ);
        redDiv.setAttribute("data-orig-bounding-client-rect",JSON.stringify(redDivRect));
        redDiv.setAttribute("data-orig-offset-left", Number(redDiv.offsetLeft));
        redDiv.setAttribute("data-orig-offset-top", Number(redDiv.offsetTop));
        return redDiv;
      }

      // Function to update the report element
      function updateReport() {
        var reportMessage = generateReportMessage();
        report(reportMessage);
      }

      // Function to generate the report message
      function generateReportMessage() {
        var redDivHzCtr = getFirstRedDivHzCtr();
        var canvasHzCtr = getCanvasHzCtr();
        var leftColumnHzCtr = getLeftColumnHzCtr();
        var windowHzCtr = getWindowHzCtr();
        var centerDivHzCtr = getCenterDivHzCtr();
        var centerDivVtCtr = getCenterDivVtCtr();
        var leftColumnScrollTop = getLeftColumnScrollTop();
        var leftColumnOffsetHeight = getLeftColumnOffsetHeight();
        var canvasScrollTop = getCanvasScrollTop();
        var canvasOffsetHeight = getCanvasOffsetHeight();

        var reportMessage =
          "Window event type: " +
          window.event.type +
          "\n" +
          "Red-Div Horizontal Center: " +
          redDivHzCtr +
          "\n" +
          "Canvas Horizontal Center: " +
          canvasHzCtr +
          "\n" +
          "Left Column Horizontal Center: " +
          leftColumnHzCtr +
          "\n" +
          "Window Horizontal Center: " +
          windowHzCtr +
          "\n" +
          "Center-Div Horizontal Center: " +
          centerDivHzCtr +
          "\n" +
          "Center-Div Vertical Center: " +
          centerDivVtCtr +
          "\n" +
          "Left Column ScrollTop: " +
          leftColumnScrollTop +
          "\n" +
          "Left Column OffsetHeight: " +
          leftColumnOffsetHeight +
          "\n" +
          "Canvas ScrollTop: " +
          canvasScrollTop +
          "\n" +
          "Canvas OffsetHeight: " +
          canvasOffsetHeight;

        return reportMessage;
      }

      // Function to handle window resize event
      function handleResize() {
        var windowWidth = window.innerWidth;
        var leftColumnWidth = windowWidth / 2;

        document.getElementById("left-column").style.width =
          leftColumnWidth + "px";
        document.getElementById("canvas").style.width = leftColumnWidth + "px";

        updateRedDivs();
        centerDiv();
        updateReport();
      }

      // Function to handle window load event
      function handleLoad() {
        updateRedDivs();
        centerDiv();
        updateReport();
      }

      // Function to handle left-column scroll event
      function handleLeftColumnScroll() {
        centerDiv();
        updateReport();
      }

      // Function to update the horizontal center (hz-ctr) of red-divs
      function updateRedDivs() {
        var canvas = document.getElementById("canvas");
        var redDivs = canvas.getElementsByClassName("red-div");
        var canvasHzCtr = canvas.offsetWidth / 2;

        for (var i = 0; i < redDivs.length; i++) {
          var redDiv = redDivs[i];
          var redDivHzCtr = redDiv.offsetWidth / 2;
          redDiv.style.left = canvasHzCtr - redDivHzCtr + "px";
        }
      }

      // Function to get the canvas-relative horizontal center (hz-ctr) of the first red div
      function getFirstRedDivHzCtr() {
        var redDiv = document.querySelector(".red-div");
        var canvas = document.getElementById("canvas");
        var redDivRect = redDiv.getBoundingClientRect();
        var canvasRect = canvas.getBoundingClientRect();
        var redDivHzCtr = redDivRect.left - canvasRect.left + (redDivRect.width / 2);
        return redDivHzCtr;
      }

      // Function to get the horizontal center (hz-ctr) of the canvas
      function getCanvasHzCtr() {
        var canvas = document.getElementById("canvas");
        var canvasHzCtr = canvas.offsetWidth / 2;
        return canvasHzCtr;
      }

      // Function to get the horizontal center (hz-ctr) of the left column
      function getLeftColumnHzCtr() {
        var leftColumn = document.getElementById("left-column");
        var leftColumnHzCtr = leftColumn.offsetWidth / 2;
        return leftColumnHzCtr;
      }

      // Function to get the horizontal center (hz-ctr) of the window
      function getWindowHzCtr() {
        var windowHzCtr = window.innerWidth / 2;
        return windowHzCtr;
      }

      // Function to get the horizontal center (hz-ctr) of the center div
      function getCenterDivHzCtr() {
        var centerDiv = document.getElementById("center-div");
        var canvas = document.getElementById("canvas");
        var centerDivHzCtr =
          centerDiv.offsetLeft - canvas.offsetLeft + centerDiv.offsetWidth / 2;
        return centerDivHzCtr;
      }

      // Function to get the vertical center (vt-ctr) of the center div
      function getCenterDivVtCtr() {
        var centerDiv = document.getElementById("center-div");
        var leftColumn = document.getElementById("left-column");
        var canvas = document.getElementById("canvas");
        var centerDivVtCtr =
          leftColumn.offsetHeight / 2 +
          (canvas.offsetTop - leftColumn.scrollTop) +
          centerDiv.offsetHeight / 2;
        return centerDivVtCtr;
      }

      // Function to get the scrollTop of the left column
      function getLeftColumnScrollTop() {
        var leftColumn = document.getElementById("left-column");
        var scrollTop = leftColumn.scrollTop;
        return scrollTop;
      }

      // Function to get the offsetHeight of the left column
      function getLeftColumnOffsetHeight() {
        var leftColumn = document.getElementById("left-column");
        var offsetHeight = leftColumn.offsetHeight;
        return offsetHeight;
      }

      // Function to get the scrollTop of the canvas
      function getCanvasScrollTop() {
        var canvas = document.getElementById("canvas");
        var scrollTop = canvas.scrollTop;
        return scrollTop;
      }

      // Function to get the offsetHeight of the canvas
      function getCanvasOffsetHeight() {
        var canvas = document.getElementById("canvas");
        var offsetHeight = canvas.offsetHeight;
        return offsetHeight;
      }

      // Function to center the div in the left column
      function centerDiv() {
        var leftColumn = document.getElementById("left-column");
        var canvas = document.getElementById("canvas");
        var centerDiv = document.getElementById("center-div");

        var scrollTop = leftColumn.scrollTop;
        var top =
          (leftColumn.offsetHeight - centerDiv.offsetHeight) / 2 + scrollTop;

        centerDiv.style.top = top + "px";
      }

      function applyMotionParallax(parallax_dh,parallax_dv) {
        var redDivs = canvas.getElementsByClassName("red-div");
        for (var i = 0; i < redDivs.length; i++) {
          var redDiv = redDivs[i];
          var origTop = parseInt(redDiv.attributes.getNamedItem('data-orig-offset-top').value);
          var origLeft = parseInt(redDiv.attributes.getNamedItem('data-orig-offset-left').value);

          // apply the motion parallax 
          var newTop = origTop + parallax_dv + "px";
          var newLeft = origLeft + parallax_dh + "px";
          console.log("redDiv["+i+"] newLeft:" + newLeft + " newTop:" + newTop);

          //redDiv.style.top = newTop;
          //redDiv.style.left = newLeft;
          //console.log("redDiv["+i+"] style.left:" + redDiv.style.left + " style.top:" + redDiv.style.top);
        }
      }
  
      // Function to handle mousemove event on the canvas
      function handleCanvasMouseMove(event) {
        var canvas = document.getElementById("canvas");
        var canvasRect = canvas.getBoundingClientRect();
        var mouseX = event.clientX - canvasRect.left;
        var mouseY = event.clientY - canvasRect.top;

        var centerDiv = document.getElementById("center-div");
        var centerDivRect = centerDiv.getBoundingClientRect();
        var centerDivX =
          centerDivRect.left - canvasRect.left + centerDivRect.width / 2;
        var centerDivY =
          centerDivRect.top - canvasRect.top + centerDivRect.height / 2;

        var parallax_dh = mouseX - centerDivX;
        var parallax_dv = mouseY - centerDivY;

        applyMotionParallax(parallax_dh,parallax_dv);
      }

      // Attach event listeners
      window.addEventListener("resize", handleResize);
      window.addEventListener("load", handleLoad);
      document
        .getElementById("left-column")
        .addEventListener("scroll", handleLeftColumnScroll);

      var canvas = document.getElementById("canvas");
      canvas.addEventListener("mousemove", handleCanvasMouseMove);

      // Generate 10 red divs with additional properties
      for (var i = 0; i < 10; i++) {
        var redDiv = createRedDiv();
        canvas.appendChild(redDiv);
      }
    </script>
  </body>
</html>
